
# 部署说明（速查）

本文件用于快速指引 Wayfarer 的部署流程。

更完整、可直接照抄的生产部署说明（含 Nginx/systemd 示例、环境变量清单）请以仓库根目录 `README.md` 为准。

## 推荐部署形态（单机）

- Nginx 监听 `:443`（域名 `waf.pscly.cc`）
- 路由：
  - `/v1/` -> 后端 `http://127.0.0.1:8000`
  - `/` -> Web `http://127.0.0.1:3000`

## 最小检查清单

1) Backend

- 配置 PostgreSQL（生产推荐）与 `WAYFARER_DB_URL`
- 配置稳定的 JWT 签名 key：`WAYFARER_JWT_SIGNING_KEYS_JSON` + `WAYFARER_JWT_KID_CURRENT`
- 配置 CORS/COOKIE：`WAYFARER_CORS_ALLOW_ORIGIN`、`WAYFARER_DEV_COOKIE_SECURE`
- 运行迁移：`uv run alembic upgrade head`

2) Web

- 配置 `NEXT_PUBLIC_API_BASE_URL=https://waf.pscly.cc`
- 构建：`npm ci && npm run build`

3) Nginx

- 站点配置生效后执行：`nginx -t && systemctl reload nginx`
